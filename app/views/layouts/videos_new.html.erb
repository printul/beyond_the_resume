<!DOCTYPE html>
<html>
<head>
  <style>
    .loader {
      border: 13px solid #f3f3f3;
      border-radius: 50%;
      border-top: 13px solid #459BF1;
      border-bottom: 13px solid #459BF1;
      width: 300px;
      height: 300px;
      -webkit-animation: spin 4s linear infinite;
      animation: spin 4s linear infinite;
    }

    @-webkit-keyframes spin {
      0% { -webkit-transform: rotate(0deg); }
      100% { -webkit-transform: rotate(360deg); }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loader2 {
      border: 13px solid #f3f3f3;
      border-radius: 50%;
      width: 300px;
      height: 300px;
      transition: height 3s;
      -webkit-transition: height 3s;
    }
  </style>


  <title>Be:yond</title>
    <%= csrf_meta_tags %>
    <%= action_cable_meta_tag %>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <%= stylesheet_link_tag    'application', media: 'all' %>
    <link rel="stylesheet" href="//assets-cdn.ziggeo.com/v1-stable/ziggeo.css" />
    <script src="//assets-cdn.ziggeo.com/v1-stable/ziggeo.js"></script>
    <script>ZiggeoApi.token = "r17f8d61d50e0795659099b07b0fab0e";
    ZiggeoApi.Config.webrtc = true;</script>
    <script>
    ZiggeoApi.Events.on("system_ready", function() {
            var element = document.getElementById('ziggeo');
            var recorder = ZiggeoApi.V2.Recorder.findByElement(element);
            var ziggeo_div = document.getElementById('ziggeo_div');
            var custom_upload_visual = document.getElementById('custom-upload-visual');

            recorder.on("loaded", function () {
              //Your code goes here
              console.log('bleh');
            });

            recorder.on("uploading", function () {
              //Your code goes here
              console.log('uploading');
              ziggeo_div.hidden = true;
              custom_upload_visual.hidden = false;
            });

            recorder.on("recording", function () {
              //Your code goes here
              console.log('RECORDING IN PROGRESS');
            });

            recorder.on("verified", function () {
              //Your code goes here
              console.log(recorder.get('video'));
            });

            recorder.on("upload_progress", function ( uploaded, total ) {
              //Your code goes here
              console.log('upload progress:' + (uploaded/total) * 100);
            });
        });
    </script>
</head>
<body>
    <%= render 'shared/navbar' %>
    <%= render 'shared/flashes' %>
    <% if user_signed_in?  %>
      <% unless current_user.is_business? %>
        <%= render 'shared/page_title_bar' %>
        <div class="sidebar">
          <%= render 'shared/sidebar' %>
        </div>
      <% end %>
    <% end %>
      <div class="fixed-navbar fixed-sidebar">
        <div class="container">
          <div class="box box-full-height">
            <h1>New video for <%= current_user.first_name %> <%= current_user.last_name %></h1>
            <div class="text-center" id="ziggeo_div">
              <ziggeorecorder
              id='ziggeo'
              ziggeo-width=640
              ziggeo-height=480
              ziggeo-tags='<%= current_user.id %>'
              ziggeo-simulate='true'>
              </ziggeorecorder>
            </div>
            <div class="loader"></div>
            <div class="loader2"></div>
            <div id="bleh"></div>
            <div style="height: 485px" hidden=true id='custom-upload-visual'>

            </div>
          </div>
        </div>
      </div>
      <%= render 'shared/footer' %>
      <%= javascript_include_tag 'application' %>
      <script>

        var a = 0;
        if (a < 100) {
          var b = setInterval(function(){ab();},1000);
        }
        function ab () {
            a += 1;
            document.getElementById('bleh').innerHTML = Math.round(a);
            if (a > 10) {
              clearInterval(b);
            }
        }
      </script>
</body>
</html>
